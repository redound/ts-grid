var TSGrid;!function(a){var b=function(){function a(){this.tagName="div",this.attributes={},this.cid=_.uniqueId("view")}return a.prototype.$=function(a){return this.$el.find(a)},a.prototype.initialize=function(){this._ensureElement()},a.prototype.render=function(){return this},a.prototype.remove=function(){return this._removeElement(),this},a.prototype._removeElement=function(){this.$el.remove()},a.prototype.setElement=function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},a.prototype._setElement=function(a){this.$el=$(a),this.el=this.$el[0]},a.prototype.delegateEvents=function(b){if(b||(b=_.result(this,"viewEvents")),!b)return this;this.undelegateEvents();for(var c in b){var d=b[c];if(_.isFunction(d)||(d=this[d]),d){var e=c.match(a.DELEGATE_EVENT_SPLITTER);this.delegate(e[1],e[2],_.bind(d,this))}}return this},a.prototype.delegate=function(a,b,c){return this.$el.on(a+".delegateEvents"+this.cid,b,c),this},a.prototype.undelegateEvents=function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},a.prototype.undelegate=function(a,b,c){return this.$el.off(a+".delegateEvents"+this.cid,b,c),this},a.prototype._createElement=function(a){return document.createElement(a)},a.prototype._ensureElement=function(){if(this.el)this.setElement(_.result(this,"el"));else{var a=_.extend({},_.result(this,"attributes"));this.id&&(a.id=_.result(this,"id")),this.className&&(a["class"]=_.result(this,"className")),this.setElement(this._createElement(_.result(this,"tagName"))),this._setAttributes(a)}},a.prototype._setAttributes=function(a){this.$el.attr(a)},a.DELEGATE_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,a}();a.View=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){!function(a){a[a.NONE=0]="NONE",a[a.ARROW_UP=1]="ARROW_UP",a[a.ARROW_DOWN=2]="ARROW_DOWN",a[a.ARROW_LEFT=3]="ARROW_LEFT",a[a.ARROW_RIGHT=4]="ARROW_RIGHT",a[a.TAB=5]="TAB",a[a.SHIFT_TAB=6]="SHIFT_TAB",a[a.ENTER=7]="ENTER",a[a.BACKSPACE=8]="BACKSPACE",a[a.SAVE=9]="SAVE",a[a.CANCEL=10]="CANCEL"}(a.CommandTypes||(a.CommandTypes={}));a.CommandTypes}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(){function b(){}return b.prototype.setType=function(a){this.commandType=a},b.prototype.setEvent=function(b){this.event=b,b&&_.extend(this,{type:b.type,altKey:!!b.altKey,"char":b["char"],charCode:b.charCode,ctrlKey:!!b.ctrlKey,key:b.key,keyCode:b.keyCode,locale:b.locale,location:b.location,metaKey:!!b.metaKey,repeat:!!b.repeat,shiftKey:!!b.shiftKey,which:b.which}),38===this.keyCode?this.commandType=a.CommandTypes.ARROW_UP:40===this.keyCode?this.commandType=a.CommandTypes.ARROW_DOWN:this.shiftKey&&9===this.keyCode?this.commandType=a.CommandTypes.SHIFT_TAB:37===this.keyCode?this.commandType=a.CommandTypes.ARROW_LEFT:this.shiftKey||9!==this.keyCode?39===this.keyCode?this.commandType=a.CommandTypes.ARROW_RIGHT:this.shiftKey||13!==this.keyCode?8===this.keyCode?this.commandType=a.CommandTypes.BACKSPACE:27===this.keyCode?this.commandType=a.CommandTypes.CANCEL:this.commandType=a.CommandTypes.NONE:this.commandType=a.CommandTypes.ENTER:this.commandType=a.CommandTypes.TAB},b.prototype.getEvent=function(){return this.event},b.prototype.blurred=function(){return"blur"===this.type},b.prototype.submitted=function(){return"submit"===this.type},b.prototype.clicked=function(){return"click"===this.type},b.prototype.arrowUp=function(){return this.commandType===a.CommandTypes.ARROW_UP},b.prototype.arrowDown=function(){return this.commandType===a.CommandTypes.ARROW_DOWN},b.prototype.arrowLeft=function(){return this.commandType===a.CommandTypes.ARROW_LEFT},b.prototype.arrowRight=function(){return this.commandType===a.CommandTypes.ARROW_RIGHT},b.prototype.shiftTab=function(){return this.commandType===a.CommandTypes.SHIFT_TAB},b.prototype.tab=function(){return this.commandType===a.CommandTypes.TAB},b.prototype.moveUp=function(){return this.arrowUp()},b.prototype.moveDown=function(){return this.arrowDown()},b.prototype.moveLeft=function(){return this.arrowLeft()||this.shiftTab()},b.prototype.moveRight=function(){return this.arrowRight()||this.tab()},b.prototype.enter=function(){return this.commandType===a.CommandTypes.ENTER},b.prototype.backspace=function(){return this.commandType===a.CommandTypes.BACKSPACE},b.prototype.cancel=function(){return this.commandType===a.CommandTypes.CANCEL},b.prototype.navigate=function(){return this.moveUp()||this.moveDown()||this.moveLeft()||this.moveRight()},b.prototype.navigateWhileEdit=function(){return this.navigate()&&!this.arrowLeft()&&!this.arrowRight()},b.prototype.input=function(){return-1!==b.ALLOWED_INPUT.indexOf(this.keyCode)},b.prototype.passThru=function(){return!(this.navigate()||this.enter()||this.cancel())},b.fromEvent=function(a){var c=new b;return c.setEvent(a),c},b.fromType=function(a){var c=new b;return c.setType(a),c},b.ALLOWED_INPUT=[100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,167,177,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,91,92,93,94,95,96,97,98,99,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],b}();a.Command=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(){function a(a,b){this.rowIndex=a,this.columnIndex=b}return a.prototype.maxRowIndex=function(a){this.rowIndex=Math.min(a,Math.max(0,this.rowIndex))},a.prototype.maxColumnIndex=function(a){this.columnIndex=Math.min(a,Math.max(0,this.columnIndex))},a.prototype.same=function(a){return a.rowIndex===this.rowIndex&&a.columnIndex===this.columnIndex},a}();a.GridPosition=b}(TSGrid||(TSGrid={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},TSGrid;!function(a){var b=function(b){function c(c,d,e){b.call(this),this.tagName="div",this.className="ts-grid-body",this.row=a.Row,this.columns=c,this.items=d,this.row=e,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){var a=this;b.prototype.initialize.call(this);this.getGrid();this.rows=this.items.map(function(b){return new a.row(a.columns,b)}),this.items.events.on(TSCore.Data.List.Events.ADD,function(b){return a.insertRows(b)}),this.items.events.on(TSCore.Data.List.Events.REMOVE,function(b){return a.removeRows(b)})},c.prototype.setGrid=function(b){this._grid=b,b.events.on(a.TSGridEvents.EDITED,this.moveToNextCell,this),b.events.on(a.TSGridEvents.NAVIGATE,this.moveToNextCell,this)},c.prototype.getGrid=function(){return this._grid},c.prototype.insertRow=function(a,b,c){if(_.isUndefined(c))return void this.items.add(a);var d=new this.row(this.columns,a),b=c.indexOf(a);this.rows.insert(d,b);var e=this.$el.find("tbody"),f=e.children(),g=d.render().$el;b>=f.length?e.append(g):f.eq(b).before(g)},c.prototype.insertRows=function(a){var b=this,c=a.params.operations;_.each(c,function(a){b.insertRow(a.item,a.index,b.items)})},c.prototype.removeRows=function(a){var b=this,c=a.params.operations,d=_.map(c,function(a){return b.rows.get(a.index)});_.each(d,function(a){a.remove(),b.rows.remove(a)})},c.prototype.removeRow=function(a){return this.items.remove(a),this},c.prototype.refresh=function(){},c.prototype.render=function(){this.$el.empty();var a=document.createElement("table"),b=document.createElement("tbody");return a.appendChild(b),this.rows.each(function(a){b.appendChild(a.render().el)}),this.el.appendChild(a),this.delegateEvents(),this},c.prototype.remove=function(){return this.rows.each(function(a){a.remove.apply(a,arguments)}),b.prototype.remove.call(this)},c.prototype.moveToNextCell=function(b){var c,d,e,f,g,h=b.params.model,i=b.params.column,j=b.params.command,k=this.items.indexOf(h),l=this.columns.indexOf(i);if(-1===l)return this;var m=this.rows.get(k).cells.get(l);if(j.navigate()||j.blurred()){var n=this.columns.length,o=n*this.items.length;if(j.blurred())m.blur();else if(j.moveUp()||j.moveDown()){f=k+(j.moveUp()?-1:1);var p=this.rows.get(f);if(p){if(c=p.cells.get(l),a.callByNeed(c.column.getEditable(),c.column,h)){var q=m.editModeActive;m.blur(),c.focus(),q&&c.enterEditMode(),h.events.trigger(a.TSGridEvents.NEXT,{m:f,j:l,b:!1})}}else h.events.trigger(a.TSGridEvents.NEXT,{m:f,j:l,b:!0})}else if(j.moveLeft()||j.moveRight()){var r=j.getEvent();r&&r.preventDefault();for(var s=j.moveRight(),t=k*n+l+(s?1:-1);t>=0&&o>t;s?t++:t--)if(f=~~(t/n),g=t-f*n,c=this.rows.get(f).cells.get(g),d=a.callByNeed(c.column.getRenderable(),c.column,c.model),e=a.callByNeed(c.column.getEditable(),c.column,h),d&&e){var q=m.editModeActive;m.blur(),c.focus(),q&&c.enterEditMode(),h.events.trigger(a.TSGridEvents.NEXT,{m:f,j:g,b:!1});break}t==o&&h.events.trigger(a.TSGridEvents.NEXT,{m:~~(t/n),j:t-f*n,b:!0})}}return this},c}(a.View);a.Body=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c){b.call(this),this.tagName="td",this.editModeActive=!1,this.focussed=!1,this.viewEvents={click:"click",blur:"blur",keypress:"processKeypress",keydown:"processKeydown"},this.column=a,this.model=c,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this),this.model.events.on(a.TSGridEvents.EDITED,this.doneEditing,this),a.callByNeed(this.column.getEditable(),this.column,this.model)&&this.$el.addClass("editable"),a.callByNeed(this.column.getRenderable(),this.column,this.model)&&this.$el.addClass("renderable")},c.prototype.render=function(){this.$el.empty();var a=this.column.getFormatter(),b=this.model.get(this.column.getName()),c=a?a(b):b;return this.$el.text(c),this.delegateEvents(),this},c.prototype.processKeypress=function(b){var c=a.Command.fromEvent(b);if(c.input()){var d=String.fromCharCode(b.keyCode);this.enterEditMode(!1,d)}},c.prototype.processKeydown=function(b){var c=a.Command.fromEvent(b);if(c.enter()&&this.enterEditMode(),c.backspace()&&(b.preventDefault(),this.clear()),c.navigate()){var d=this.column.getGrid();d.events.trigger(a.TSGridEvents.NAVIGATE,{column:this.column,model:this.model,command:c})}},c.prototype.click=function(){this.focussed?this.enterEditMode():this.focus()},c.prototype.focus=function(){this.focussed=!0,this.$el.attr("tabindex",0),this.$el.focus(),this.$el.addClass("active")},c.prototype.blur=function(){this.editModeActive&&this.exitEditMode(),this.focussed=!1,this.$el.removeClass("active"),this.$el.removeAttr("tabindex")},c.prototype.clear=function(){this.model.set(this.column.getName(),null),this.render()},c.prototype.doneEditing=function(a){var b=a.params.column,c=a.params.command;!(c.enter()||c.submitted()||c.cancel())||null!=b&&b.getId()!=this.column.getId()||(this.editModeActive&&this.exitEditMode(),this.focus())},c.prototype.enterEditMode=function(b,c){var d=this;void 0===b&&(b=!0);var e=a.callByNeed(this.column.getEditable(),this.column,this.model);if(e){var f=this.column.getEditor();this.currentEditor=f(this.column,this.model),this.model.events.trigger(a.TSGridEvents.EDIT,{model:this.model,column:this.column,cell:this,editor:this.currentEditor}),this.undelegateEvents(),c&&this.currentEditor.setValue(c),this.currentEditor.autoFocus(),b&&this.currentEditor.selectAll(),this.currentEditor.render(),setTimeout(function(){d.$el.empty(),d.$el.append(d.currentEditor.$el),d.$el.addClass("editor"),d.$el.addClass(d.currentEditor.getEditorName())},10),this.editModeActive=!0,this.model.events.trigger(a.TSGridEvents.EDITING,{model:this.model,column:this.column,cell:this,editor:this.currentEditor})}},c.prototype.renderError=function(a,b){(null==b||b.getName()==this.column.getName())&&this.$el.addClass("error")},c.prototype.exitEditMode=function(){this.editModeActive=!1,this.$el.removeClass("error"),this.$el.removeClass(this.currentEditor.getEditorName()),this.currentEditor.remove(),delete this.currentEditor,this.$el.removeClass("editor"),this.render()},c.prototype.remove=function(){return this.currentEditor&&(this.currentEditor.remove.apply(this.currentEditor,arguments),delete this.currentEditor),this},c}(a.View);a.Cell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c,d){b.call(this),this.options=new TSCore.Data.Dictionary,this._autoFocus=!1,this._selectAll=!1,this.column=a,this.model=c,this.editorName=d,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this)},c.prototype.getEditorName=function(){return this.editorName},c.prototype.autoFocus=function(){return this._autoFocus=!0,this},c.prototype.shouldAutoFocus=function(){return this._autoFocus},c.prototype.selectAll=function(){return this._selectAll=!0,this},c.prototype.shouldSelectAll=function(){return this._selectAll},c.prototype.setValue=function(a){this.value=a},c.prototype.option=function(a,b){return this.options.set(a,b),this},c.prototype.save=function(b,c){var d=this.model,e=this.column,f=e.getGrid();d.set(e.getName(),c);var g={model:d,column:e,command:a.Command.fromType(b)};f.events.trigger(a.TSGridEvents.EDITED,g),d.events.trigger(a.TSGridEvents.EDITED,g)},c.prototype.cancel=function(b){var c=this.model,d=this.column,e=d.getGrid(),f={model:c,column:d,command:a.Command.fromType(b)};e.events.trigger(a.TSGridEvents.EDITED,f),c.events.trigger(a.TSGridEvents.EDITED,f)},c.prototype.render=function(){return this.$el.attr(this.editorName,""),this.$el.attr("cell-editor-options","options"),this.compile(this.$el),this},c.prototype.compile=function(a){this.destroyScope();var b=angular.element(document).injector(),c=b.get("$compile"),d=b.get("$rootScope");return this.$scope=d.$new(),this.options.set("model",_.isUndefined(this.value)?this.model.get(this.column.getName()):this.value),this.options.set("editor",this),this.$scope.options=this.options.toObject(),c(a)(this.$scope)},c.prototype.destroyScope=function(){this.$scope&&(this.$scope.$destroy(),delete this.$scope)},c.prototype.remove=function(){return this.destroyScope(),b.prototype.remove.call(this),this},c}(a.View);a.CellEditor=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(){function b(){this._renderable=!0,this._editable=!1,this._uniqId=parseInt(_.uniqueId())}return b.prototype.getId=function(){return this._uniqId},b.prototype.setGrid=function(a){this._grid=a},b.prototype.getGrid=function(){return this._grid},b.prototype.name=function(a){return this._name=a,this},b.prototype.getName=function(){return this._name},b.prototype.label=function(a){return this._label=a,this},b.prototype.getLabel=function(){return this._label},b.prototype.renderable=function(a){return this._renderable=a,this},b.prototype.getRenderable=function(){return this._renderable},b.prototype.editable=function(a){return this._editable=a,this},b.prototype.getEditable=function(){return this._editable},b.prototype.getHeaderType=function(){return a.resolveNameToClass("header-cell")},b.prototype.editor=function(a){return this._editor=a,this},b.prototype.getEditor=function(){return this._editor},b.prototype.formatter=function(a){return this._formatter=a,this},b.prototype.getFormatter=function(){return this._formatter},b}();a.Column=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c){b.call(this),this.tagName="tr",this.columns=a,this.model=c,this.cells=new TSCore.Data.List,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){var a=this;b.prototype.initialize.call(this),this.columns.each(function(b){a.cells.add(a.makeCell(b))})},c.prototype.makeCell=function(b){return new a.Cell(b,this.model)},c.prototype.render=function(){this.$el.empty();var a=document.createDocumentFragment();return this.cells.each(function(b){a.appendChild(b.render().el)}),this.el.appendChild(a),this.delegateEvents(),this},c.prototype.reset=function(){},c}(a.View);a.Row=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.highlightColor="#F5F5F5",this.viewEvents={focusin:"rowFocused",focusout:"rowLostFocus"}}return __extends(b,a),b.prototype.rowFocused=function(){this.removeHighlightTimeout&&clearTimeout(this.removeHighlightTimeout),this.$el.css("backgroundColor",this.highlightColor)},b.prototype.rowLostFocus=function(){var a=this;this.removeHighlightTimeout=setTimeout(function(){a.$el.css("backgroundColor","initial"),a.removeHighlightTimeout=null},40)},b}(a.Row);a.FocusableRow=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c,d){b.call(this),this.tagName="div",this.className="ts-grid",this.events=new TSCore.Events.EventEmitter,this.setHeader(a),this.setBody(c),this.setColumns(d),this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this)},c.prototype.setHeader=function(a){a.setGrid(this),this._header=a},c.prototype.getHeader=function(){return this._header},c.prototype.setBody=function(a){a.setGrid(this),this._body=a},c.prototype.getBody=function(){return this._body},c.prototype.setColumns=function(a){var b=this;a.each(function(a){a.setGrid(b)}),this._columns=a},c.prototype.getColumns=function(){return this._columns},c.prototype.insertRow=function(){return this._body.insertRow.apply(this._body,arguments),this},c.prototype.removeRow=function(){return this._body.removeRow.apply(this._body,arguments),this},c.prototype.render=function(){return this.$el.empty(),this._header&&this.$el.append(this._header.render().$el),this.$el.append(this._body.render().$el),this.delegateEvents(),this.events.trigger(a.TSGridEvents.RENDERED),this},c.prototype.remove=function(){return this._header&&this._header.remove.apply(this._header,arguments),this._body.remove.apply(this._body,arguments),b.prototype.remove.call(this)},c}(a.View);a.Grid=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a){b.call(this),this.tagName="div",this.className="ts-grid-header",this.columns=a,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this),this.row=new a.HeaderRow(this.columns,null)},c.prototype.setGrid=function(a){this._grid=a},c.prototype.getGrid=function(){return this._grid},c.prototype.render=function(){var a=document.createElement("table");return a.appendChild(this.row.render().el),this.el.appendChild(a),this.delegateEvents(),this},c.prototype.reset=function(){},c}(a.View);a.Header=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(b){a.call(this),this.tagName="th",this.viewEvents={"click a":"onClick"},this.column=b,this.initialize()}return __extends(b,a),b.prototype.initialize=function(){a.prototype.initialize.call(this)},b.prototype.render=function(){this.$el.empty();var a=document.createTextNode(this.column.getLabel());return this.$el.append(a),this.$el.addClass(this.column.getName()),this.delegateEvents(),this},b}(a.View);a.HeaderCell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.makeCell=function(a){var b=a.getHeaderType();return new b(a,this.model)},b}(a.Row);a.HeaderRow=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){function b(b,c){if(void 0===c&&(c=""),_.isString(b)){var d=_.map(b.split("-"),function(a){return a.slice(0,1).toUpperCase()+a.slice(1)}).join("")+c,e=a[d]||a.Extension[d];if(_.isUndefined(e))throw new ReferenceError("Class '"+d+"' not found");return e}return b}function c(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=arguments[0];if(!_.isFunction(c))return c;var d=arguments[1],e=[].slice.call(arguments,2);return c.apply(d,e+""?e:[])}a.Extension={},a.resolveNameToClass=b,a.callByNeed=c;var d;!function(a){a.RENDERED="tsGrid:rendered",a.SORT="tsGrid:sort",a.EDIT="tsGrid:edit",a.EDITING="tsGrid:editing",a.EDITED="tsGrid:edited",a.ERROR="tsGrid:error",a.NEXT="tsGrid:next",a.NAVIGATE="tsGrid:navigate"}(d=a.TSGridEvents||(a.TSGridEvents={}))}(TSGrid||(TSGrid={}));