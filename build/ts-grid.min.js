var TSGrid;!function(a){!function(a){a[a.NONE=0]="NONE",a[a.UP=1]="UP",a[a.DOWN=2]="DOWN",a[a.LEFT=3]="LEFT",a[a.RIGHT=4]="RIGHT",a[a.TAB=5]="TAB",a[a.SHIFT_TAB=6]="SHIFT_TAB",a[a.ENTER=7]="ENTER",a[a.BACKSPACE=8]="BACKSPACE",a[a.DELETE=9]="DELETE",a[a.BLUR=10]="BLUR",a[a.ESC=11]="ESC"}(a.CommandTypes||(a.CommandTypes={}));a.CommandTypes}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=TSCore.App.UI.KeyCodes,c=function(){function c(){}return c.prototype.type=function(a){this._type=a},c.prototype.fromEvent=function(c){switch(!0){case"blur"===c.type:this._type=a.CommandTypes.BLUR;break;case c.keyCode===b.UP:this._type=a.CommandTypes.UP;break;case c.keyCode===b.DOWN:this._type=a.CommandTypes.DOWN;break;case c.shiftKey&&c.keyCode===b.TAB:this._type=a.CommandTypes.SHIFT_TAB;break;case c.keyCode===b.LEFT:this._type=a.CommandTypes.LEFT;break;case!c.shiftKey&&c.keyCode===b.TAB:this._type=a.CommandTypes.TAB;break;case c.keyCode===b.RIGHT:this._type=a.CommandTypes.RIGHT;break;case!c.shiftKey&&c.keyCode===b.ENTER:this._type=a.CommandTypes.ENTER;break;case c.keyCode===b.BACKSPACE:this._type=a.CommandTypes.BACKSPACE;break;case c.keyCode===b.DELETE:this._type=a.CommandTypes.DELETE;break;case c.keyCode===b.ESCAPE:this._type=a.CommandTypes.ESC;break;default:this._type=a.CommandTypes.NONE}},c.prototype.blur=function(){return this._type===a.CommandTypes.BLUR},c.prototype.up=function(){return this._type===a.CommandTypes.UP},c.prototype.down=function(){return this._type===a.CommandTypes.DOWN},c.prototype.left=function(){return this._type===a.CommandTypes.LEFT},c.prototype.right=function(){return this._type===a.CommandTypes.RIGHT},c.prototype.shiftTab=function(){return this._type===a.CommandTypes.SHIFT_TAB},c.prototype.tab=function(){return this._type===a.CommandTypes.TAB},c.prototype.enter=function(){return this._type===a.CommandTypes.ENTER},c.prototype.backspace=function(){return this._type===a.CommandTypes.BACKSPACE},c.prototype["delete"]=function(){return this._type===a.CommandTypes.DELETE},c.prototype.esc=function(){return this._type===a.CommandTypes.ESC},c.fromEvent=function(a){var b=new c;return b.fromEvent(a),b},c.fromType=function(a){var b=new c;return b.type(a),b},c}();a.Command=c}(TSGrid||(TSGrid={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},TSGrid;!function(a){var b=function(b){function c(c,d,e,f){void 0===f&&(f=a.Row),b.call(this),this.tagName="div",this.className="ts-grid-body",this.cols=new TSCore.Data.List,this.rowType=a.Row,this.events=new TSCore.Events.EventEmitter,this._delegate=c,this.columns=d,this.collection=e,this.rowType=f,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){var c=this;b.prototype.initialize.call(this),this.rows=new TSCore.Data.List;var d=this.collection.all();this.models=new TSCore.Data.SortedList(d,this._delegate.bodyPrimaryKeyForModels(this)),this.models.setSortPredicate(this._delegate.bodyDefaultSortPredicateForModels(this),this._delegate.bodyDefaultSortDirectionForModels(this)),this.models.each(function(a){c.rows.add(new c.rowType(c.columns,a))}),this.collection.events.on(TSCore.Data.CollectionEvents.ADD,function(a){return c.addModels(a)}),this.collection.events.on(TSCore.Data.CollectionEvents.REMOVE,function(a){return c.removeModels(a)}),this.models.events.on(TSCore.Data.SortedListEvents.ADD,function(a){return c.addRows(a)}),this.models.events.on(TSCore.Data.SortedListEvents.REMOVE,function(a){return c.removeRows(a)}),this.models.events.on(TSCore.Data.SortedListEvents.SORT,function(a){return c.refresh(a)}),this.columns.each(function(b){b.events.on(a.ColumnEvents.CHANGED_WIDTH,function(a){return c.columnChangedWidth(a)})})},c.prototype.columnChangedWidth=function(a){var b=a.params.column,c=this.columns.indexOf(b),d=this.cols.get(c);d&&d.width(b.getWidth())},c.prototype.getDelegate=function(){return this._delegate},c.prototype.addModels=function(a){var b=this,c=a.params.operations;_.each(c,function(a){console.log("add item '"+a.item.get("title")+"' from models, collectionIndex: '"+a.index+"', modelsIndex: '"+b.models.indexOf(a.item)+"'"),b.models.add(a.item)})},c.prototype.removeModels=function(a){var b=this,c=a.params.operations;_.each(c,function(a){console.log("remove item '"+a.item.get("title")+"' from models, collectionIndex: '"+a.index+"', modelsIndex: '"+b.models.indexOf(a.item)+"'"),b.models.remove(a.item)})},c.prototype.setGrid=function(b){this._grid=b,b.events.on(a.TSGridEvents.EDITED,this.moveToNextCell,this),b.events.on(a.TSGridEvents.NAVIGATE,this.moveToNextCell,this),b.events.on(a.TSGridEvents.CLICK,this.moveToCell,this)},c.prototype.getGrid=function(){return this._grid},c.prototype.prependEmptyRow=function(){var b=this;this.emptyRow=new this.rowType(this.columns,this._delegate.bodyModelForEmptyRow(this)),this.emptyRow.events.on(a.RowEvents.CHANGED,function(a){return b.emptyRowDidChange(a)}),this.rows.prepend(this.emptyRow),this.insertRow(this.emptyRow)},c.prototype.removeEmptyRow=function(){this.emptyRow&&(this.rows.remove(this.emptyRow),this.emptyRow.remove())},c.prototype.emptyRowDidChange=function(a){var b=a.params.row;b.valid=this._delegate.bodyValidateModel(this,b.model)},c.prototype.addRow=function(a,b,c){if(_.isUndefined(c))return void this.collection.add(a);var d=new this.rowType(this.columns,a);this.rows.add(d),this.insertRow(d)},c.prototype.insertRow=function(a){var b=this.rows.indexOf(a),c=this.$tbody.children(),d=a.render().$el;b>=c.length?this.$tbody.append(d):c.eq(b).before(d)},c.prototype.addRows=function(a){var b=this,c=a.params.operations;console.log("addRows",c),_.each(c,function(a){b.addRow(a.item,a.index,b.collection)})},c.prototype.removeRows=function(a){var b=this,c=a.params.operations;console.log("removeRows",c);var d=_.map(c,function(a){return b.rows.get(a.index)});_.each(d,function(a){a.remove(),b.rows.remove(a)})},c.prototype.removeRow=function(a){return this.collection.remove(a),this},c.prototype.refresh=function(b){var c=this,d=this.getGrid();this.rows.each(function(a){a.remove()}),this.rows=new TSCore.Data.List,this.models.each(function(a){var b=new c.rowType(c.columns,a);c.rows.add(b)}),this.render(),d.events.trigger(a.TSGridEvents.REFRESH,{body:this})},c.prototype.render=function(){var a=this,b=this.getGrid();return this.$el.empty(),this.$table=$("<table />"),this.$tbody=$("<tbody />"),this.$colgroup=$("<colgroup />"),this.cols.clear(),this.columns.each(function(b){var c=$("<col />");c.css("width",b.getWidth()),a.$colgroup.append(c),a.cols.add(c)}),this.$table.append(this.$colgroup),this.$table.append(this.$tbody),this.rows.each(function(b){a.$tbody.append(b.render().$el)}),this.$table.attr("width",b.getInnerWidth()),this.$el.append(this.$table),this.delegateEvents(),this},c.prototype.remove=function(){return this.rows.each(function(a){a.remove.apply(a,arguments)}),b.prototype.remove.call(this),this},c.prototype.getActiveCell=function(){var a=this.activePosition.model,b=this.activePosition.column;return this.getCell(a,b)},c.prototype.getCell=function(a,b){var c=this.rows.whereFirst({modelId:a.getId()}),d=this.rows.indexOf(c),e=this.columns.indexOf(b);return this.rows.get(d).cells.get(e)},c.prototype.moveToCell=function(a){var b=a.params.model,c=this.rows.whereFirst({modelId:b.getId()}),d=a.params.column,e=this.getCell(b,d);this.activate(c,e)},c.prototype.deactivateCell=function(){this.activeRow&&this.activeRow.setActive(!1),this.activeCell&&this.activeCell.deactivate()},c.prototype.activate=function(a,b){if(this.beforeActivateCell(b.column,a.model)!==!1&&b.column.getEditable()!==!1){if(this.activeRow!==a){var c=this.activeRow;this.activeRow=a,this.changedRow(c,a)}if(this.activeCell!==b){var d=this.activeCell;this.activeCell&&this.activeCell.deactivate(),this.activeCell=b,this.changedCell(d,b)}b.isActivated()?(console.debug("enterEditMode"),b.enterEditMode()):(console.debug("activate"),b.activate())}},c.prototype.changedRow=function(b,c){var d=this;if(b&&b.setActive(!1),c&&c.setActive(!0),console.debug("fromRow",b,"toRow",c),b&&b!==this.emptyRow){b.valid=this._delegate.bodyValidateModel(this,b.model);var e=this._delegate.bodyShouldUpdateModel(this,b.model);b.valid&&e&&(b.setLoading(!0),this._delegate.bodyUpdateModel(this,b.model).then(function(a){b.setLoading(!1),d._delegate.bodyAfterUpdateModel(d,b.model)}))}if(b&&b===this.emptyRow&&this.emptyRow.valid){var f=this.emptyRow.model;this._delegate.bodyBeforeCreateModel(this,f),this.emptyRow.setLoading(!0),this._delegate.bodyCreateModel(this,f).then(function(a){d.emptyRow.setLoading(!1),d.models.add(a),d._delegate.bodyAfterCreateModel(d,a),d.focusEmptyRow()})}this.events.trigger(a.BodyEvents.CHANGED_ROW,{fromRow:b,toRow:c})},c.prototype.focusEmptyRow=function(){this.activeRow=null,this.activeCell=null;var a=this.rows.get(0),b=a.cells.get(0);this.activate(a,b)},c.prototype.changedCell=function(b,c){console.debug("fromCell",b,"toCell",c),this.events.trigger(a.BodyEvents.CHANGED_CELL,{fromCell:b,toCell:c})},c.prototype.moveToNextCell=function(b){var c,d,e,f,g,h=this.getGrid(),i=b.params.model,j=b.params.column,k=b.params.command,l=this.rows.whereFirst({modelId:i.id}),m=this.rows.indexOf(l),n=this.columns.indexOf(j);if(-1===n)return this;if((k.enter()||k.esc()||k.blur())&&this.activeCell.editModeActive&&(this.activeCell.exitEditMode(),this.activeCell.activate()),k.enter()||k.left()||k.right()||k.up()||k.down()||k.shiftTab()||k.tab()){var o=this.columns.length,p=o*this.rows.length;if(k.up()||k.down()||k.enter()){f=m+(k.up()?-1:1);var l=this.rows.get(f);l?(c=l.cells.get(n),a.callByNeed(c.column.getEditable(),c.column,i)&&(this.activate(l,c),h.events.trigger(a.TSGridEvents.NEXT,{row:f,column:n,outside:!1}))):h.events.trigger(a.TSGridEvents.NEXT,{row:f,column:n,outside:!0})}else if(k.left()||k.right()||k.shiftTab||k.tab()){for(var q=k.right()||k.tab(),r=m*o+n+(q?1:-1);r>=0&&p>r;q?r++:r--)if(f=~~(r/o),g=r-f*o,c=this.rows.get(f).cells.get(g),d=a.callByNeed(c.column.getRenderable(),c.column,c.model),e=a.callByNeed(c.column.getEditable(),c.column,i),d&&e){this.activate(l,c),h.events.trigger(a.TSGridEvents.NEXT,{row:f,column:g,outside:!1});break}r==p&&h.events.trigger(a.TSGridEvents.NEXT,{row:~~(r/o),column:r-f*o,outside:!0})}}return this},c.prototype.beforeActivateCell=function(a,b){return!0},c}(TSCore.App.UI.View);a.Body=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b;!function(a){a.CHANGED_ROW="body:changedRow",a.CHANGED_CELL="body:changedCell"}(b=a.BodyEvents||(a.BodyEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c){b.call(this),this.tagName="td",this.editModeActive=!1,this.viewEvents={click:"click",keypress:"keypress",keydown:"keydown"},this.events=new TSCore.Events.EventEmitter,this.activated=!1,this._validationEnabled=!1,this.column=a,this.model=c,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this),a.callByNeed(this.column.getEditable(),this.column,this.model)&&this.$el.addClass("editable"),a.callByNeed(this.column.getRenderable(),this.column,this.model)&&this.$el.addClass("renderable")},c.prototype.validationEnabled=function(a){return void 0===a&&(a=!0),this._validationEnabled=a,this},c.prototype.getValidationEnabled=function(){return this._validationEnabled},c.prototype.setModelValue=function(a){var b=this.column.getSetter();return b?b(this.model,a):this.model.set(this.column.getName(),a),this},c.prototype.getModelValue=function(){var a=this.column.getGetter();return a?a(this.model):this.model.get(this.column.getName())},c.prototype.render=function(){this.$el.empty();var a=this.column.getFormatter(),b=this.column.getGetter(),c=b?b(this.model):this.model.get(this.column.getName()),d=a?a(this.model):c;this.$el.html(d);var e=this.column.getClassName();return e&&this.$el.addClass(e),this.getValidationEnabled()&&this.model.isValid(this.column.getName())===!1&&this.model.isDirty(this.column.getName())===!0?this.$el.addClass("error"):this.$el.removeClass("error"),this.delegateEvents(),this},c.prototype.keypress=function(a){var b=-1!==c.CELL_INPUT.indexOf(a.keyCode);if(this.column.getEditOnInput()&&b&&!a.metaKey&&!a.ctrlKey){var d=String.fromCharCode(a.keyCode);this.enterEditMode(d)}},c.prototype.keydown=function(b){var c=a.Command.fromEvent(b);if(c.enter()&&this.enterEditMode(),(c.backspace()||c["delete"]())&&(b.preventDefault(),b.stopPropagation(),this.column.getAllowClear()&&(this.clear(),this.activate())),c.left()||c.right()||c.up()||c.down()||c.shiftTab()||c.tab()){b.preventDefault();var d=this.column.getGrid();d.events.trigger(a.TSGridEvents.NAVIGATE,{column:this.column,model:this.model,command:c})}},c.prototype.click=function(b){var c=this.column.getGrid();c.events.trigger(a.TSGridEvents.CLICK,{column:this.column,model:this.model,event:b})},c.prototype.blur=function(){this.$el.removeClass("active"),this.$el.removeAttr("tabindex")},c.prototype.activate=function(){this.$el.attr("tabindex",0),this.$el.addClass("active"),this.$el.focus(),this.activated=!0},c.prototype.isActivated=function(){return this.activated},c.prototype.deactivate=function(){this.editModeActive&&this.exitEditMode(),this.blur(),this.activated=!1},c.prototype.clear=function(){var b=this.column.getOnClear(),c=this.column.getSetter();b?b(this.model):c?c(this.model,null):this.model.set(this.column.getName(),null),this.events.trigger(a.CellEvents.CLEARED,{cell:this})},c.prototype.enterEditMode=function(b){var c=this;if(!this.editModeActive){var d=a.callByNeed(this.column.getEditable(),this.column,this.model);if(d){var e=this.column.getEditor();this.currentEditor=e(this,this.column,this.model),this.model.events.trigger(a.TSGridEvents.EDIT,{model:this.model,column:this.column,cell:this,editor:this.currentEditor}),this.undelegateEvents(),b&&this.currentEditor.setInitialModelValue(b),this.currentEditor.events.on(a.CellEditorEvents.SAVE,function(a){return c.cellEditorOnSave(a)}),this.currentEditor.events.on(a.CellEditorEvents.CANCEL,function(a){return c.cellEditorOnCancel(a)}),this.currentEditor.render(),setTimeout(function(){c.blur(),c.$el.empty(),c.$el.append(c.currentEditor.$el),c.$el.addClass("editor"),c.$el.addClass(c.currentEditor.getEditorName())},10),this.editModeActive=!0,this.model.events.trigger(a.TSGridEvents.EDITING,{model:this.model,column:this.column,cell:this,editor:this.currentEditor})}}},c.prototype.cellEditorOnSave=function(b){var c=b.params.modelValue;this.setModelValue(c),this.events.trigger(a.CellEvents.CHANGED,b.params);var d=this.column.getGrid();d.events.trigger(a.TSGridEvents.EDITED,b.params)},c.prototype.cellEditorOnCancel=function(b){var c=this.column.getGrid();c.events.trigger(a.TSGridEvents.EDITED,b.params)},c.prototype.exitEditMode=function(){this.editModeActive=!1,this.$el.removeClass("error"),this.$el.removeClass(this.currentEditor.getEditorName()),this.currentEditor.remove(),delete this.currentEditor,this.$el.removeClass("editor"),this.render()},c.prototype.remove=function(){return this.currentEditor&&(this.currentEditor.remove.apply(this.currentEditor,arguments),delete this.currentEditor),this},c.CELL_INPUT=[100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,167,177,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,91,92,93,94,95,96,97,98,99,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90],c}(TSCore.App.UI.View);a.Cell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c,d){b.call(this),this.events=new TSCore.Events.EventEmitter,this.setColumn(a),this.setModel(c),this.setEditorName(d),this.initialize()}return __extends(c,b),c.prototype.setColumn=function(a){return this.column=a,this},c.prototype.getColumn=function(){return this.column},c.prototype.setModel=function(a){return this.model=a,this},c.prototype.getModel=function(){return this.model},c.prototype.setEditorName=function(a){return this.editorName=a,this},c.prototype.getEditorName=function(){return this.editorName},c.prototype.setInitialModelValue=function(a){return this.initialModelValue=a,this},c.prototype.getInitialModelValue=function(){return this.initialModelValue},c.prototype.getModelValue=function(){var a=this.column.getGetter();return a?a(this.model):this.model.get(this.column.getName())},c.prototype.save=function(b,c){var d=this.model,e=this.column,f={modelValue:c,model:d,column:e,command:b};this.events.trigger(a.CellEditorEvents.SAVE,f)},c.prototype.cancel=function(b){var c=this.model,d=this.column,e={model:c,column:d,command:b};this.events.trigger(a.CellEditorEvents.CANCEL,e)},c}(TSCore.App.UI.View);a.CellEditor=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b;!function(a){a.SAVE="cellEditor:save",a.CANCEL="cellEditor:cancel"}(b=a.CellEditorEvents||(a.CellEditorEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b;!function(a){a.CHANGED="cell:changed",a.CLEARED="cell:cleared"}(b=a.CellEvents||(a.CellEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(){function b(){this._resizable=!1,this._renderable=!0,this._editOnInput=!1,this._editable=!1,this._sortable=!1,this._allowClear=!1,this._cellType=a.Cell,this.events=new TSCore.Events.EventEmitter,this._uniqId=parseInt(_.uniqueId())}return b.prototype.className=function(a){return this._className=a,this},b.prototype.getClassName=function(){return this._className},b.prototype.getId=function(){return this._uniqId},b.prototype.setGrid=function(a){this._grid=a},b.prototype.getGrid=function(){return this._grid},b.prototype.resizable=function(a){return void 0===a&&(a=!0),this._resizable=a,this},b.prototype.getResizable=function(){return this._resizable},b.prototype.minWidth=function(a){return this._minWidth=a,this},b.prototype.getMinWidth=function(){return this._minWidth},b.prototype.maxWidth=function(a){return this._maxWidth=a,this},b.prototype.getMaxWidth=function(){return this._maxWidth},b.prototype.width=function(b){var c=this._width;return this._width=b,this.events.trigger(a.ColumnEvents.CHANGED_WIDTH,{column:this,fromWidth:c,toWidth:b}),this},b.prototype.getWidth=function(){return this._width},b.prototype.name=function(a){return this._name=a,this},b.prototype.getName=function(){return this._name},b.prototype.titleFormatter=function(a){return this._titleFormatter=a,this},b.prototype.getTitleFormatter=function(){return this._titleFormatter},b.prototype.getTitle=function(){return this._titleFormatter(this)},b.prototype.renderable=function(a){return this._renderable=a,this},b.prototype.getRenderable=function(){return this._renderable},b.prototype.editable=function(a){return void 0===a&&(a=!0),this._editable=a,this},b.prototype.getEditable=function(){return this._editable},b.prototype.sortable=function(a){return void 0===a&&(a=!0),this._sortable=a,this},b.prototype.getSortable=function(){return this._sortable},b.prototype.editOnInput=function(a){return void 0===a&&(a=!0),this._editOnInput=a,this},b.prototype.getEditOnInput=function(){return this._editOnInput},b.prototype.getHeaderType=function(){return a.resolveNameToClass("header-cell")},b.prototype.editor=function(a){return this._editor=a,this},b.prototype.getEditor=function(){return this._editor},b.prototype.allowClear=function(a){return void 0===a&&(a=!0),this._allowClear=a,this},b.prototype.getAllowClear=function(){return this._allowClear},b.prototype.onClear=function(a){return this._onClear=a,this},b.prototype.getOnClear=function(){return this._onClear},b.prototype.cellType=function(a){return this._cellType=a,this},b.prototype.getCellType=function(){return this._cellType},b.prototype.setter=function(a){return this._setter=a,this},b.prototype.getSetter=function(){return this._setter},b.prototype.getter=function(a){return this._getter=a,this},b.prototype.getGetter=function(){return this._getter},b.prototype.parser=function(a){return this._parser=a,this},b.prototype.getParser=function(){return this._parser},b.prototype.formatter=function(a){return this._formatter=a,this},b.prototype.getFormatter=function(){return this._formatter},b}();a.Column=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b;!function(a){a.CHANGED_WIDTH="changedWidth"}(b=a.ColumnEvents||(a.ColumnEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(){b.call(this),this.tagName="div",this.className="manualColumnResizer",this.viewEvents={mousedown:"mousedown",mouseup:"mouseup"},this.events=new TSCore.Events.EventEmitter,this._active=!1,this.initialize()}return __extends(c,b),c.prototype.mousedown=function(){this.events.trigger(a.ColumnResizerEvents.MOUSEDOWN,{columnResizer:this})},c.prototype.mouseup=function(){this.events.trigger(a.ColumnResizerEvents.MOUSEUP,{columnResizer:this})},c.prototype.setActive=function(a){return this._active!==a&&(a?this.$el.addClass("active"):this.$el.removeClass("active")),this._active=a,this},c.prototype.getActive=function(){return this._active},c}(TSCore.App.UI.View);a.ColumnResizer=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b;!function(a){a.MOUSEUP="mouseup",a.MOUSEDOWN="mousedown"}(b=a.ColumnResizerEvents||(a.ColumnResizerEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.call(this),this.tagName="div",this.className="manualColumnResizerGuide",this._active=!1,this.initialize()}return __extends(b,a),b.prototype.setActive=function(a){return this._active!==a&&(a?this.$el.addClass("active"):this.$el.removeClass("active")),this._active=a,this},b.prototype.getActive=function(){return this._active},b}(TSCore.App.UI.View);a.ColumnResizerGuide=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=TSCore.Data.SortedListDirection,c=function(c){function d(b,d,e){c.call(this),this.tagName="div",this.className="ts-grid",this.events=new TSCore.Events.EventEmitter,this._columnResizer=new a.ColumnResizer,this._columnResizerGuide=new a.ColumnResizerGuide,this.setHeader(b),this.setBody(d),this.setColumns(e),this.initialize()}return __extends(d,c),d.prototype.initialize=function(){var a=this;c.prototype.initialize.call(this),$(document).on("mouseup",function(b){return a.documentOnMouseUp(b)}),$(document).on("mouseleave",function(b){return a.documentOnMouseLeave(b)}),$(document).on("mousemove",function(b){return a.documentOnMouseMove(b)})},d.prototype.documentOnMouseLeave=function(a){this.resetColumnResizer()},d.prototype.resetColumnResizer=function(){this._columnResizer.setActive(!1),this._columnResizerGuide.setActive(!1),this.createColumnResizer(),this._resizeHeaderCell=null},d.prototype.documentOnMouseMove=function(a){this.mousePageOffsetX=a.pageX,this._columnResizer.getActive()&&this.positionColumnResizer(this.mousePageOffsetX)},d.prototype.positionColumnResizer=function(a){var b=this._body.$el.height(),c=this._body.$el.offset(),d=this._columnResizer.$el.offset(),e=this._columnResizer.$el.width(),f=this._columnResizerGuide.$el.outerWidth(),g=e-f;this._columnResizer.$el.offset({top:d.top,left:a?a:d.left}),this._columnResizerGuide.$el.offset({top:c.top,left:(a?a:d.left)+g}),this._columnResizerGuide.$el.height(b)},d.prototype.documentOnMouseUp=function(a){if(this._columnResizer.getActive()){this._columnResizer.setActive(!1),this._columnResizerGuide.setActive(!1),this.createColumnResizer();var b=this._resizeHeaderCell;this._resizeHeaderCell=null;var c=b.column.getMinWidth(),d=b.column.getMaxWidth(),e=b.column.getWidth(),f=e+(this.mousePageOffsetX-this.columnResizeStartOffsetX),g=Math.min(Math.max(f,c),d);b.column.getResizable()&&b.column.width(g)}},d.prototype.createColumnResizer=function(){var b=this;this._columnResizer&&this._columnResizer.remove(),this._columnResizerGuide&&this._columnResizerGuide.remove(),this._columnResizer=new a.ColumnResizer,this._columnResizerGuide=new a.ColumnResizerGuide,this._columnResizer.events.on(a.ColumnResizerEvents.MOUSEDOWN,function(a){return b.columnResizerOnMouseDown(a)}),this.$el.append(this._columnResizer.render().$el),this.$el.append(this._columnResizerGuide.render().$el)},d.prototype.columnResizerOnMouseDown=function(a){this.columnResizeStartOffsetX=this._columnResizer.$el.offset().left,this._columnResizer.setActive(!0),this._columnResizerGuide.setActive(!0),this._resizeHeaderCell=this._lastHeaderCell,this.positionColumnResizer()},d.prototype.sort=function(a,b){this._body.models.setSortPredicate(a,b),this.afterSort(a,b)},d.prototype.afterSort=function(a,b){if(this._header){var c=this._header.row;c.cells.each(function(c){c.column.getName()===a?(console.log(c.column.getName()+" was clicked"),c.setSortDirection(b)):c.setSortDirection(null)})}},d.prototype.setHeader=function(a){return a.setGrid(this),this._header=a,this},d.prototype.getHeader=function(){return this._header},d.prototype.setBody=function(a){return a.setGrid(this),this._body=a,this},d.prototype.getBody=function(){return this._body},d.prototype.setColumns=function(a){return this._columns=a,this.calculateWidth(),this},d.prototype.calculateWidth=function(){var a=this,b=0;this._columns.each(function(c){c.setGrid(a),b+=c.getWidth()}),this._width=b},d.prototype.getColumns=function(){return this._columns},d.prototype.getInnerWidth=function(){return this._width},d.prototype.getWidth=function(){return this._width+2},d.prototype.render=function(){return this.$el.empty(),this._header&&(this.$el.append(this._header.render().$el),this.listenHeaderCells()),this.$el.append(this._body.render().$el),this.createColumnResizer(),this.delegateEvents(),this.events.trigger(a.TSGridEvents.RENDERED),this},d.prototype.listenHeaderCells=function(){var b=this,c=this._header.row;c.cells.each(function(c){c.events.on(a.HeaderCellEvents.CLICK,function(a){return b.headerCellOnClick(a)}),c.events.on(a.HeaderCellEvents.MOUSEENTER,function(a){return b.headerCellOnMouseEnter(a)}),c.events.on(a.HeaderCellEvents.MOUSELEAVE,function(a){return b.headerCellOnMouseLeave(a)}),c.column.events.on(a.ColumnEvents.CHANGED_WIDTH,function(a){return b.columnChangedWidth(a)})})},d.prototype.columnChangedWidth=function(b){this.calculateWidth(),this._header.$table.attr("width",this.getInnerWidth()),this._body.$table.attr("width",this.getInnerWidth()),this.events.trigger(a.TSGridEvents.CHANGED_WIDTH,{grid:this})},d.prototype.headerCellOnClick=function(a){var b=(this._header.row,a.params.headerCell);b.column.getSortable()&&this.sortName(b.column.getName())},d.prototype.headerCellOnMouseEnter=function(a){var b=a.params.headerCell;this._lastHeaderCell=b,this.positionColumnResizerAtHeaderCell(b)},d.prototype.headerCellOnMouseLeave=function(a){a.params.headerCell},d.prototype.positionColumnResizerAtHeaderCell=function(a){if(!this._columnResizer.getActive()&&a.column.getResizable()!==!1){var b=a.$el.outerHeight(),c=a.$el.offset(),d=this._columnResizer.$el.width();this._columnResizer.$el.offset({top:c.top,left:c.left+a.column.getWidth()-d+1}),this._columnResizer.$el.height(b)}},d.prototype.sortName=function(a){var c=this._body.models.getSortPredicate(),d=this._body.models.getSortDirection(),e=d===TSCore.Data.SortedListDirection.ASCENDING?TSCore.Data.SortedListDirection.DESCENDING:TSCore.Data.SortedListDirection.ASCENDING;if(a===c)switch(d){case b.ASCENDING:e=b.DESCENDING;break;case b.DESCENDING:a=this._body.getDelegate().bodyDefaultSortPredicateForModels(this._body),e=this._body.getDelegate().bodyDefaultSortDirectionForModels(this._body);break;default:e=b.ASCENDING}else e=TSCore.Data.SortedListDirection.ASCENDING;this.sort(a,e)},d.prototype.remove=function(){return this._header&&this._header.remove.apply(this._header,arguments),this._body.remove.apply(this._body,arguments),c.prototype.remove.call(this),this},d}(TSCore.App.UI.View);a.Grid=c}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a){b.call(this),this.tagName="div",this.className="ts-grid-header",this.viewEvents={dragstart:"dragstart"},this.cols=new TSCore.Data.List,this.columns=a,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){var c=this;b.prototype.initialize.call(this),this.row=new a.HeaderRow(this.columns),this.columns.each(function(b){b.events.on(a.ColumnEvents.CHANGED_WIDTH,function(a){return c.columnChangedWidth(a)})})},c.prototype.columnChangedWidth=function(a){var b=a.params.column,c=this.columns.indexOf(b),d=this.cols.get(c);d&&d.width(b.getWidth())},c.prototype.dragstart=function(a){a.preventDefault(),a.stopPropagation()},c.prototype.setGrid=function(a){return this._grid=a,this},c.prototype.getGrid=function(){return this._grid},c.prototype.render=function(){var a=this,b=this.getGrid();this.$table=$("<table />"),this.$colgroup=$("<colgroup />"),this.cols.clear(),this.columns.each(function(b){var c=$("<col />");c.css("width",b.getWidth()),a.$colgroup.append(c),a.cols.add(c)});var c=$("<thead />");return this.$table.append(this.$colgroup),this.$table.append(c),c.append(this.row.render().$el),this.$table.attr("width",b.getInnerWidth()),this.$el.append(this.$table),this.delegateEvents(),this},c}(TSCore.App.UI.View);a.Header=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c){b.call(this),this.tagName="th",this.viewEvents={mouseenter:"mouseenter",mouseleave:"mouseleave","click a":"click"},this.events=new TSCore.Events.EventEmitter,this.sortDirection=null,this.column=a,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){var c=this;b.prototype.initialize.call(this),this.column.events.on(a.ColumnEvents.CHANGED_WIDTH,function(a){return c.columnChangedWidth(a)})},c.prototype.columnChangedWidth=function(a){this.render()},c.prototype.click=function(){this.events.trigger(a.HeaderCellEvents.CLICK,{headerCell:this})},c.prototype.mouseenter=function(){this.events.trigger(a.HeaderCellEvents.MOUSEENTER,{headerCell:this})},c.prototype.mouseleave=function(){this.events.trigger(a.HeaderCellEvents.MOUSELEAVE,{headerCell:this})},c.prototype.setSortDirection=function(a){this.sortDirection!==a&&(this.sortDirection=a,this.render())},c.prototype.render=function(){this.$el.empty();var a;return a=this.column.getSortable()?$('<a href="javascript:void(0)">'+this.column.getTitle()+"</a>"):document.createTextNode(this.column.getTitle()),this.$el.removeClass("asc"),this.$el.removeClass("desc"),this.sortDirection===TSCore.Data.SortedListDirection.ASCENDING&&this.$el.addClass("asc"),this.sortDirection===TSCore.Data.SortedListDirection.DESCENDING&&this.$el.addClass("desc"),this.$el.append(a),this.$el.addClass(this.column.getClassName()),this.column.getSortable()&&this.$el.addClass("sortable"),this.delegateEvents(),this},c}(TSCore.App.UI.View);a.HeaderCell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b;!function(a){a.CLICK="click",a.MOUSEENTER="mouseenter",a.MOUSELEAVE="mouseleave"}(b=a.HeaderCellEvents||(a.HeaderCellEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c){b.call(this),this.tagName="tr",this.events=new TSCore.Events.EventEmitter,this.valid=!1,this.columns=a,this.setModel(c),this.cells=new TSCore.Data.List,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){var a=this;b.prototype.initialize.call(this),this.columns.each(function(b){a.cells.add(a.makeCell(b))})},c.prototype.setLoading=function(a){this._loading=a,this._loading?this.$el.addClass("loading"):this.$el.removeClass("loading")},c.prototype.setActive=function(a){this._active=a,this._active?this.$el.addClass("active"):this.$el.removeClass("active")},c.prototype.setModel=function(a){return a?(this.model=a,this.modelId=a.getId(),this):void 0},c.prototype.makeCell=function(b){var c=this,d=b.getCellType(),e=new d(b,this.model);return e.events.on(a.CellEvents.CHANGED,function(a){return c.cellDidChange(a)}),e.events.on(a.CellEvents.CLEARED,function(a){return c.cellDidClear(a)}),e},c.prototype.cellDidChange=function(b){this.events.trigger(a.RowEvents.CHANGED,{row:this}),this.render()},c.prototype.cellDidClear=function(a){this.render()},c.prototype.render=function(){this.$el.empty();var a=document.createDocumentFragment();
return this.cells.each(function(b){b.validationEnabled(!0),a.appendChild(b.render().el)}),this.el.appendChild(a),this.delegateEvents(),this},c.prototype.reset=function(){},c}(TSCore.App.UI.View);a.Row=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(b){a.call(this),this.tagName="tr",this.columns=b,this.cells=new TSCore.Data.List,this.initialize()}return __extends(b,a),b.prototype.initialize=function(){var b=this;a.prototype.initialize.call(this),this.columns.each(function(a){b.cells.add(b.makeCell(a))})},b.prototype.makeCell=function(a){var b=a.getHeaderType();return new b(a)},b.prototype.render=function(){this.$el.empty();var a=document.createDocumentFragment();return this.cells.each(function(b){a.appendChild(b.render().el)}),this.el.appendChild(a),this.delegateEvents(),this},b}(TSCore.App.UI.View);a.HeaderRow=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b;!function(a){a.CHANGED="row:changed"}(b=a.RowEvents||(a.RowEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){function b(b,c){if(void 0===c&&(c=""),_.isString(b)){var d=_.map(b.split("-"),function(a){return a.slice(0,1).toUpperCase()+a.slice(1)}).join("")+c,e=a[d]||a.Extension[d];if(_.isUndefined(e))throw new ReferenceError("Class '"+d+"' not found");return e}return b}function c(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=arguments[0];if(!_.isFunction(c))return c;var d=arguments[1],e=[].slice.call(arguments,2);return c.apply(d,e+""?e:[])}a.Extension={},a.resolveNameToClass=b,a.callByNeed=c;var d;!function(a){a.RENDERED="tsGrid:rendered",a.REFRESH="tsGrid:refresh",a.SORT="tsGrid:sort",a.EDIT="tsGrid:edit",a.EDITING="tsGrid:editing",a.EDITED="tsGrid:edited",a.ERROR="tsGrid:error",a.NEXT="tsGrid:next",a.NAVIGATE="tsGrid:navigate",a.CHANGED_WIDTH="tsGrid:changedWidth",a.CLICK="tsGrid:click"}(d=a.TSGridEvents||(a.TSGridEvents={}))}(TSGrid||(TSGrid={}));