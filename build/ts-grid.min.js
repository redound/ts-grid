var TSGrid;!function(a){var b=function(){function a(){}return a.prototype.listenTo=function(a,b,c){},a.prototype.trigger=function(a,b){},a}();a.Events=b}(TSGrid||(TSGrid={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},TSGrid;!function(a){var b=function(a){function b(){a.call(this),this.tagName="div",this.attributes={},this.cid=_.uniqueId("view")}return __extends(b,a),b.prototype.$=function(a){return this.$el.find(a)},b.prototype.initialize=function(){this._ensureElement()},b.prototype.render=function(){return this},b.prototype.remove=function(){return this._removeElement(),this},b.prototype._removeElement=function(){this.$el.remove()},b.prototype.setElement=function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},b.prototype._setElement=function(a){this.$el=$(a),this.el=this.$el[0]},b.prototype.delegateEvents=function(a){if(a||(a=_.result(this,"viewEvents")),!a)return this;this.undelegateEvents();for(var c in a){var d=a[c];if(_.isFunction(d)||(d=this[d]),d){var e=c.match(b.DELEGATE_EVENT_SPLITTER);this.delegate(e[1],e[2],_.bind(d,this))}}return this},b.prototype.delegate=function(a,b,c){return this.$el.on(a+".delegateEvents"+this.cid,b,c),this},b.prototype.undelegateEvents=function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},b.prototype.undelegate=function(a,b,c){return this.$el.off(a+".delegateEvents"+this.cid,b,c),this},b.prototype._createElement=function(a){return document.createElement(a)},b.prototype._ensureElement=function(){if(this.el)this.setElement(_.result(this,"el"));else{var a=_.extend({},_.result(this,"attributes"));this.id&&(a.id=_.result(this,"id")),this.className&&(a["class"]=_.result(this,"className")),this.setElement(this._createElement(_.result(this,"tagName"))),this._setAttributes(a)}},b.prototype._setAttributes=function(a){this.$el.attr(a)},b.DELEGATE_EVENT_SPLITTER=/^(\S+)\s*(.*)$/,b}(a.Events);a.View=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(c,d,e){b.call(this),this.tagName="div",this.className="ts-grid-body",this.row=a.Row,this.columns=c,this.items=d,this.row=e,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){var a=this;b.prototype.initialize.call(this);this.getGrid();this.rows=this.items.map(function(b){return new a.row(a.columns,b)}),this.items.events.on(TSCore.Data.List.Events.ADD,function(b){return a.insertRows(b)}),this.items.events.on(TSCore.Data.List.Events.REMOVE,function(b){return a.removeRows(b)})},c.prototype.setGrid=function(b){this._grid=b,b.events.on(a.TSGridEvents.EDITED,this.moveToNextCell,this)},c.prototype.getGrid=function(){return this._grid},c.prototype.insertRow=function(a,b,c){if(_.isUndefined(c))return void this.items.add(a);var d=new this.row(this.columns,a),b=c.indexOf(a);this.rows.insert(d,b);var e=this.$el.find("tbody"),f=e.children(),g=d.render().$el;b>=f.length?e.append(g):f.eq(b).before(g)},c.prototype.insertRows=function(a){var b=this,c=a.params.operations;_.each(c,function(a){b.insertRow(a.item,a.index,b.items)})},c.prototype.removeRows=function(a){var b=this,c=a.params.operations,d=_.map(c,function(a){return b.rows.get(a.index)});_.each(d,function(a){a.remove(),b.rows.remove(a)})},c.prototype.removeRow=function(a){return this.items.remove(a),this},c.prototype.refresh=function(){},c.prototype.render=function(){this.$el.empty();var a=document.createElement("table"),b=document.createElement("tbody");return a.appendChild(b),this.rows.each(function(a){b.appendChild(a.render().el)}),this.el.appendChild(a),this.delegateEvents(),this},c.prototype.remove=function(){return this.rows.each(function(a){a.remove.apply(a,arguments)}),b.prototype.remove.call(this)},c.prototype.moveToNextCell=function(b){var c,d,e,f,g,h=b.params.model,i=b.params.column,j=b.params.command,k=this.items.indexOf(h),l=this.columns.indexOf(i);if(-1===l)return this;if(this.rows.get(k).cells.get(l).exitEditMode(),j.moveUp()||j.moveDown()||j.moveLeft()||j.moveRight()||j.save()){var m=this.columns.length,n=m*this.items.length;if(j.moveUp()||j.moveDown()){f=k+(j.moveUp()?-1:1);var o=this.rows.get(f);o?(c=o.cells.get(l),a.callByNeed(c.column.getEditable(),c.column,h)&&(c.enterEditMode(),h.events.trigger(a.TSGridEvents.NEXT,{m:f,j:l,b:!1}))):h.events.trigger(a.TSGridEvents.NEXT,{m:f,j:l,b:!0})}else if(j.moveLeft()||j.moveRight()){for(var p=j.moveRight(),q=k*m+l+(p?1:-1);q>=0&&n>q;p?q++:q--)if(f=~~(q/m),g=q-f*m,c=this.rows.get(f).cells.get(g),d=a.callByNeed(c.column.getRenderable(),c.column,c.model),e=a.callByNeed(c.column.getEditable(),c.column,h),d&&e){c.enterEditMode(),h.events.trigger(a.TSGridEvents.NEXT,{m:f,j:g,b:!1});break}q==n&&h.events.trigger(a.TSGridEvents.NEXT,{m:~~(q/m),j:q-f*m,b:!0})}}return this},c.prototype.reset=function(){},c}(a.View);a.Body=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(c,d,e,f){b.call(this),this.tagName="td",this.editor=a.InputCellEditor,this.viewEvents={click:"enterEditMode"},this.column=c,this.model=d,this.editor=a.resolveNameToClass(this.editor,"CellEditor"),f?this.formatter=new f:this.formatter=new a.StringFormatter,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this),a.callByNeed(this.column.getEditable(),this.column,this.model)&&this.$el.addClass("editable"),a.callByNeed(this.column.getRenderable(),this.column,this.model)&&this.$el.addClass("renderable")},c.prototype.render=function(){return this.$el.empty(),this.$el.text(this.formatter.fromRaw(this.model.get(this.column.getName()),this.model)),this.delegateEvents(),this},c.prototype.enterEditMode=function(){var b=this,c=a.callByNeed(this.column.getEditable(),this.column,this.model);c&&(this.currentEditor=new this.editor(this.column,this.model,this.formatter),this.model.events.trigger(a.TSGridEvents.EDIT,{model:this.model,column:this.column,cell:this,editor:this.currentEditor}),this.undelegateEvents(),this.currentEditor.render(),setTimeout(function(){b.$el.empty(),b.$el.append(b.currentEditor.$el),b.$el.addClass("editor"),b.currentEditor.activate()},10),this.model.events.trigger(a.TSGridEvents.EDITING,{model:this.model,column:this.column,cell:this,editor:this.currentEditor}))},c.prototype.renderError=function(a,b){(null==b||b.getName()==this.column.getName())&&this.$el.addClass("error")},c.prototype.exitEditMode=function(){this.$el.removeClass("error"),this.currentEditor.remove(),delete this.currentEditor,this.$el.removeClass("editor"),this.render()},c.prototype.remove=function(){return this.currentEditor&&(this.currentEditor.remove.apply(this.currentEditor,arguments),delete this.currentEditor),this},c}(a.View);a.Cell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c,d){b.call(this),this.column=a,this.model=c,this.formatter=d}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this),this.model.events.on(a.TSGridEvents.EDITING,this.postRender,this)},c.prototype.saveOrCancel=function(b,c){var d=this.editScope.vm.model,e=(this.formatter,this.model),f=this.column,g=f.getGrid();if(c||(c=a.Command.fromEvent(b)),c.clicked()||c.submitted()||c.moveUp()||c.moveDown()||c.moveLeft()||c.moveRight()||c.save()||c.blurred()){b&&(b.preventDefault(),b.stopPropagation());e.set(f.getName(),d);var h={model:e,column:f,command:c};g.events.trigger(a.TSGridEvents.EDITED,h),e.events.trigger(a.TSGridEvents.EDITED,h)}else if(c.cancel()){b&&b.stopPropagation();var h={model:e,column:f,command:c};g.events.trigger(a.TSGridEvents.EDITED,h),e.events.trigger(a.TSGridEvents.EDITED,h)}},c.prototype.compile=function(a){this.destroyScope();var b=angular.element(document).injector(),c=b.get("$compile"),d=b.get("$rootScope");return this.editScope=d.$new(),this.editScope.vm={model:this.model.get(this.column.getName()),editor:this},c(a)(this.editScope)},c.prototype.postRender=function(a){var b=a.params.column;return(null==b||b.getName()==this.column.getName())&&this.$el.focus(),this},c.prototype.destroyScope=function(){this.editScope&&(this.editScope.$destroy(),delete this.editScope)},c.prototype.remove=function(){return this.destroyScope(),b.prototype.remove.call(this),this},c.prototype.activate=function(){this.$el.focus(),this.$el.select()},c}(a.View);a.CellEditor=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.fromRaw=function(a,b){return a},b.prototype.toRaw=function(a,b){return a},b}(TSCore.BaseObject);a.CellFormatter=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(){function b(){this._renderable=!0,this._editable=!1}return b.prototype.setGrid=function(a){this._grid=a},b.prototype.getGrid=function(){return this._grid},b.prototype.name=function(a){return this._name=a,this},b.prototype.getName=function(){return this._name},b.prototype.label=function(a){return this._label=a,this},b.prototype.getLabel=function(){return this._label},b.prototype.renderable=function(a){return this._renderable=a,this},b.prototype.getRenderable=function(){return this._renderable},b.prototype.editable=function(a){return this._editable=a,this},b.prototype.getEditable=function(){return this._editable},b.prototype.cell=function(a){return this._cell=a,this},b.prototype.getCell=function(){return this._cell},b.prototype.getCellClass=function(){return a.resolveNameToClass(this._cell+"-cell")},b.prototype.getHeaderCellClass=function(){return a.resolveNameToClass("header-cell")},b.prototype.formatter=function(a){return this._formatter=a,this},b.prototype.getFormatter=function(){return this._formatter},b.prototype.getFormatterClass=function(){return a.resolveNameToClass("string-formatter")},b}();a.Column=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){!function(a){a[a.NONE=0]="NONE",a[a.MOVE_UP=1]="MOVE_UP",a[a.MOVE_DOWN=2]="MOVE_DOWN",a[a.MOVE_LEFT=3]="MOVE_LEFT",a[a.MOVE_RIGHT=4]="MOVE_RIGHT",a[a.SAVE=5]="SAVE",a[a.CANCEL=6]="CANCEL"}(a.CommandTypes||(a.CommandTypes={}));a.CommandTypes}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(){function b(){}return b.prototype.setType=function(a){this.commandType=a},b.prototype.setEvent=function(b){b&&_.extend(this,{type:b.type,altKey:!!b.altKey,"char":b["char"],charCode:b.charCode,ctrlKey:!!b.ctrlKey,key:b.key,keyCode:b.keyCode,locale:b.locale,location:b.location,metaKey:!!b.metaKey,repeat:!!b.repeat,shiftKey:!!b.shiftKey,which:b.which}),38===this.keyCode?this.commandType=a.CommandTypes.MOVE_UP:40===this.keyCode?this.commandType=a.CommandTypes.MOVE_DOWN:this.shiftKey&&9===this.keyCode?this.commandType=a.CommandTypes.MOVE_LEFT:this.shiftKey||9!==this.keyCode?this.shiftKey||13!==this.keyCode?27===this.keyCode?this.commandType=a.CommandTypes.CANCEL:this.commandType=a.CommandTypes.NONE:this.commandType=a.CommandTypes.SAVE:this.commandType=a.CommandTypes.MOVE_RIGHT},b.prototype.blurred=function(){return"blur"===this.type},b.prototype.submitted=function(){return"submit"===this.type},b.prototype.clicked=function(){return"click"===this.type},b.prototype.moveUp=function(){return this.commandType===a.CommandTypes.MOVE_UP},b.prototype.moveDown=function(){return this.commandType===a.CommandTypes.MOVE_DOWN},b.prototype.moveLeft=function(){return this.commandType===a.CommandTypes.MOVE_LEFT},b.prototype.moveRight=function(){return this.commandType===a.CommandTypes.MOVE_RIGHT},b.prototype.save=function(){return this.commandType===a.CommandTypes.SAVE},b.prototype.cancel=function(){return this.commandType===a.CommandTypes.CANCEL},b.prototype.passThru=function(){return!(this.moveUp()||this.moveDown()||this.moveLeft()||this.moveRight()||this.save()||this.cancel())},b.fromEvent=function(a){var c=new b;return c.setEvent(a),c},b.fromType=function(a){var c=new b;return c.setType(a),c},b}();a.Command=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(b,c){a.call(this),this.tagName="tr",this.columns=b,this.model=c,this.cells=new TSCore.Data.List,this.initialize()}return __extends(b,a),b.prototype.initialize=function(){var b=this;a.prototype.initialize.call(this),this.columns.each(function(a){b.cells.add(b.makeCell(a))})},b.prototype.makeCell=function(a){var b=a.getCellClass();return new b(a,this.model)},b.prototype.render=function(){this.$el.empty();var a=document.createDocumentFragment();return this.cells.each(function(b){a.appendChild(b.render().el)}),this.el.appendChild(a),this.delegateEvents(),this},b.prototype.reset=function(){},b}(a.View);a.Row=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.highlightColor="#F5F5F5",this.viewEvents={focusin:"rowFocused",focusout:"rowLostFocus"}}return __extends(b,a),b.prototype.rowFocused=function(){this.removeHighlightTimeout&&clearTimeout(this.removeHighlightTimeout),this.$el.css("backgroundColor",this.highlightColor)},b.prototype.rowLostFocus=function(){var a=this;this.removeHighlightTimeout=setTimeout(function(){a.$el.css("backgroundColor","initial"),a.removeHighlightTimeout=null},40)},b}(a.Row);a.FocusableRow=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a,c,d){b.call(this),this.tagName="div",this.className="ts-grid",this.events=new TSCore.Events.EventEmitter,this.setHeader(a),this.setBody(c),this.setColumns(d),this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this)},c.prototype.setHeader=function(a){a.setGrid(this),this._header=a},c.prototype.getHeader=function(){return this._header},c.prototype.setBody=function(a){a.setGrid(this),this._body=a},c.prototype.getBody=function(){return this._body},c.prototype.setColumns=function(a){var b=this;a.each(function(a){a.setGrid(b)}),this._columns=a},c.prototype.getColumns=function(){return this._columns},c.prototype.insertRow=function(){return this._body.insertRow.apply(this._body,arguments),this},c.prototype.removeRow=function(){return this._body.removeRow.apply(this._body,arguments),this},c.prototype.insertColumn=function(){},c.prototype.removeColumn=function(){},c.prototype.render=function(){return this.$el.empty(),this._header&&this.$el.append(this._header.render().$el),this.$el.append(this._body.render().$el),this.delegateEvents(),this.trigger(a.TSGridEvents.RENDERED,this),this},c.prototype.remove=function(){return this._header&&this._header.remove.apply(this._header,arguments),this._body.remove.apply(this._body,arguments),b.prototype.remove.call(this)},c}(a.View);a.Grid=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(a){b.call(this),this.tagName="div",this.className="ts-grid-header",this.columns=a,this.initialize()}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this),this.row=new a.HeaderRow(this.columns,null)},c.prototype.setGrid=function(a){this._grid=a},c.prototype.getGrid=function(){return this._grid},c.prototype.render=function(){var a=document.createElement("table");return a.appendChild(this.row.render().el),this.el.appendChild(a),this.delegateEvents(),this},c.prototype.reset=function(){},c}(a.View);a.Header=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(b){a.call(this),this.tagName="th",this.viewEvents={"click a":"onClick"},this.column=b,this.initialize()}return __extends(b,a),b.prototype.initialize=function(){a.prototype.initialize.call(this)},b.prototype.render=function(){this.$el.empty();var a=document.createTextNode(this.column.getLabel());return this.$el.append(a),this.$el.addClass(this.column.getName()),this.delegateEvents(),this},b}(a.View);a.HeaderCell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.makeCell=function(a){var b=a.getHeaderCellClass();return new b(a,this.model)},b}(a.Row);a.HeaderRow=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c,d),this.tagName="input",this.attributes={type:"text"},this.viewEvents={blur:"saveOrCancel",keydown:"saveOrCancel"},this.initialize()}return __extends(b,a),b.prototype.initialize=function(){a.prototype.initialize.call(this)},b.prototype.render=function(){return this.$el.attr("ng-model","vm.model"),this.compile(this.$el),this},b}(a.CellEditor);a.InputCellEditor=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(c,d,e,f){b.call(this,c,d,e,f),this.className="number-cell",this.decimals=a.NumberFormatter.defaults.decimals,this.decimalSeparator=a.NumberFormatter.defaults.decimalSeparator,this.orderSeparator=a.NumberFormatter.defaults.orderSeparator}return __extends(c,b),c.prototype.initialize=function(){b.prototype.initialize.call(this)},c}(a.Cell);a.NumberCell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.className="integer-cell",this.decimals=0}return __extends(b,a),b}(a.NumberCell);a.IntegerCell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(b){if(a.call(this),this.decimalSeparator=".",this.orderSeparator=",",_.extend(this,this["static"].defaults,b||{}),this.decimals<0||this.decimals>20)throw new RangeError("decimals must be between 0 and 20")}return __extends(b,a),b.prototype.fromRaw=function(a,b){if(_.isNull(a)||_.isUndefined(a))return"";var c=a.toFixed(~~this.decimals),d=c.split("."),e=d[0],f=d[1]?(this.decimalSeparator||".")+d[1]:"";return e.replace(this["static"].HUMANIZED_NUM_RE,"$1"+this.orderSeparator)+f},b.prototype.toRaw=function(a,b){if(a=a.trim(),""===a)return null;for(var c="",d=a.split(this.orderSeparator),e=0;e<d.length;e++)c+=d[e];var f=c.split(this.decimalSeparator);c="";for(var e=0;e<f.length;e++)c=c+f[e]+".";"."===c[c.length-1]&&(c=c.slice(0,c.length-1));var g=parseFloat(c),h=g.toFixed(~~this.decimals);return _.isNumber(h)&&!_.isNaN(h)?h:void 0},b.HUMANIZED_NUM_RE=/(\d)(?=(?:\d{3})+$)/g,b.defaults={decimals:0,decimalSeparator:".",orderSeparator:","},b}(a.CellFormatter);a.NumberFormatter=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments),this.className="string-cell"}return __extends(b,a),b}(a.Cell);a.StringCell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b.prototype.fromRaw=function(a,b){return _.isUndefined(a)||_.isNull(a)?"":a+""},b}(a.CellFormatter);a.StringFormatter=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){function b(b,c){if(void 0===c&&(c=""),_.isString(b)){var d=_.map(b.split("-"),function(a){return a.slice(0,1).toUpperCase()+a.slice(1)}).join("")+c,e=a[d]||a.Extension[d];if(_.isUndefined(e))throw new ReferenceError("Class '"+d+"' not found");return e}return b}function c(){for(var a=[],b=0;b<arguments.length;b++)a[b-0]=arguments[b];var c=arguments[0];if(!_.isFunction(c))return c;var d=arguments[1],e=[].slice.call(arguments,2);return c.apply(d,e+""?e:[])}a.Extension={},a.resolveNameToClass=b,a.callByNeed=c;var d;!function(a){a.RENDERED="tsGrid:rendered",a.SORT="tsGrid:sort",a.EDIT="tsGrid:edit",a.EDITING="tsGrid:editing",a.EDITED="tsGrid:edited",a.ERROR="tsGrid:error",a.NEXT="tsGrid:next"}(d=a.TSGridEvents||(a.TSGridEvents={}))}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(b){function c(){b.apply(this,arguments),this.className="text-cell",this.editor=a.TextCellEditor}return __extends(c,b),c}(a.Cell);a.TextCell=b}(TSGrid||(TSGrid={}));var TSGrid;!function(a){var b=function(a){function b(b,c,d){a.call(this,b,c,d),this.tagName="div",this.viewEvents={blur:"saveOrCancel",keydown:"saveOrCancel"},this.initialize()}return __extends(b,a),b.prototype.render=function(){return this.$el.attr("text-cell-editor","vm.model"),this.$el.attr("cell-editor","vm.editor"),this.compile(this.$el),this},b}(a.CellEditor);a.TextCellEditor=b}(TSGrid||(TSGrid={}));